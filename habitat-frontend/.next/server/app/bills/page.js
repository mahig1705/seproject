(()=>{var e={};e.id=23,e.ids=[23],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},8707:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>o,routeModule:()=>m,tree:()=>d});var r=t(482),l=t(9108),a=t(2563),i=t.n(a),n=t(8300),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);t.d(s,c);let d=["",{children:["bills",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,1456)),"C:\\Users\\Mahi\\Downloads\\Habitat\\habitat-frontend\\src\\app\\bills\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,6313)),"C:\\Users\\Mahi\\Downloads\\Habitat\\habitat-frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9361,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\Users\\Mahi\\Downloads\\Habitat\\habitat-frontend\\src\\app\\bills\\page.tsx"],u="/bills/page",x={require:t,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:l.x.APP_PAGE,page:"/bills/page",pathname:"/bills",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},880:(e,s,t)=>{Promise.resolve().then(t.bind(t,3920))},8411:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(9224).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},6885:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(9224).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},1838:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(9224).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},8765:(e,s,t)=>{"use strict";t.d(s,{Z:()=>r});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,t(9224).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},3920:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>P});var r=t(2295),l=t(3729),a=t(5814),i=t(951),n=t(9956),c=t(4034),d=t(342),o=t(8649),u=t(793),x=t(2522),m=t(9865),h=t(3490),p=t(8243);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let j=(0,t(9224).Z)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);var b=t(1838),g=t(6885),y=t(5674),f=t(5794),v=t(8411),N=t(8765),w=t(1453),E=t(4669);function P(){let{user:e,hasPermission:s}=(0,a.useAuth)(),[t,P]=(0,l.useState)([]),[D,C]=(0,l.useState)([]),[k,q]=(0,l.useState)(!0),[S,A]=(0,l.useState)(""),[G,M]=(0,l.useState)(""),[I,U]=(0,l.useState)(!1),[Z,_]=(0,l.useState)(!1),[B,R]=(0,l.useState)(null),[L,z]=(0,l.useState)({amount:"",gatewayRef:""}),[F,T]=(0,l.useState)({billingPeriodStart:"",billingPeriodEnd:"",amount:0,selectedUsers:[]}),O=[{value:"",label:"All Status"},{value:h.bG.PENDING,label:"Pending"},{value:h.bG.COMPLETED,label:"Completed"},{value:h.bG.FAILED,label:"Failed"},{value:h.bG.REFUNDED,label:"Refunded"}];(0,l.useEffect)(()=>{(async()=>{if(e)try{q(!0);let s=e.role===h.i4.ADMIN||e.role===h.i4.COMMITTEE?{}:{userId:e._id},t=await p.E.getBills(s);console.log("\uD83D\uDCE6 Bills data from backend:",t);let r=t.map(e=>({...e,status:e.status||h.bG.PENDING,user:e.user||{name:"Unknown",flatNumber:"-"}}));if(P(r),e.role===h.i4.ADMIN||e.role===h.i4.COMMITTEE){let e=await p.E.getUsers();C(e.data||[])}}catch(e){console.error("❌ Failed to fetch bills:",e),E.default.error("Failed to load bills")}finally{q(!1)}})()},[e]);let $=async()=>{if(e)try{q(!0);let s=e.role===h.i4.ADMIN||e.role===h.i4.COMMITTEE?{}:{userId:e._id},t=await p.E.getBills(s),r=(Array.isArray(t)?t:[]).map(e=>({...e,status:e.status||h.bG.PENDING,user:e.user||{name:"Unknown",flatNumber:"-"}}));P(r)}catch(e){console.error("❌ Failed to fetch bills:",e),E.default.error("Failed to load bills")}finally{q(!1)}},H=e=>{R(e),z({amount:e.amount.toString(),gatewayRef:""}),U(!0)},Y=async e=>{if(e.preventDefault(),B)try{await p.E.payBill(B._id,Number(L.amount),L.gatewayRef),E.default.success("Payment processed successfully"),U(!1),$()}catch{E.default.error("Failed to process payment")}},X=()=>{T({billingPeriodStart:"",billingPeriodEnd:"",amount:0,selectedUsers:[]})},J=async e=>{if(e.preventDefault(),!F.selectedUsers.length){E.default.error("Select at least one resident");return}try{let e=F.selectedUsers.map(e=>({user:e,description:`Maintenance bill for period ${F.billingPeriodStart} to ${F.billingPeriodEnd}`,amount:F.amount,dueDate:F.billingPeriodEnd}));await p.E.generateBills(e),E.default.success("Bills generated successfully"),_(!1),X(),$()}catch{E.default.error("Failed to generate bills")}},K=t.filter(e=>{let s=e.user?.name?.toLowerCase()||"",t=(e.description?.toLowerCase()||"").includes(S.toLowerCase())||s.includes(S.toLowerCase()),r=!G||e.status===G;return t&&r}),Q=e=>{switch(e){case h.bG.PENDING:return"warning";case h.bG.COMPLETED:return"success";case h.bG.FAILED:return"danger";case h.bG.REFUNDED:return"info";default:return"default"}},V=(()=>{let e=t.length;return{totalBills:e,pendingBills:t.filter(e=>e.status===h.bG.PENDING).length,totalAmount:t.reduce((e,s)=>e+(s.amount||0),0),pendingAmount:t.filter(e=>e.status===h.bG.PENDING).reduce((e,s)=>e+(s.amount||0),0)}})();return e?r.jsx(i.A,{children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Bills"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)(c.z,{variant:"outline",onClick:$,children:[r.jsx(j,{className:"w-4 h-4 mr-2"})," Refresh"]}),s("bills:write")&&(0,r.jsxs)(c.z,{onClick:()=>_(!0),children:[r.jsx(b.Z,{className:"w-4 h-4 mr-2"})," Generate Bills"]}),(0,r.jsxs)(c.z,{variant:"outline",onClick:()=>{if(!t.length)return E.default.error("No bills to export");let e=["User,Description,Amount,Due Date,Status",...t.map(e=>[`"${e.user?.name??"Unknown"}"`,`"${e.description}"`,e.amount,(0,w.p6)(e.dueDate),e.status].join(","))].join("\n"),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(s),r.setAttribute("download","bills_export.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),E.default.success("Bills exported successfully")},children:[r.jsx(g.Z,{className:"w-4 h-4 mr-2"})," Export"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[r.jsx(n.Zb,{children:r.jsx(n.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Bills"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:V.totalBills})]}),r.jsx(y.Z,{className:"w-8 h-8 text-blue-600"})]})})}),r.jsx(n.Zb,{children:r.jsx(n.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Pending Bills"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:V.pendingBills})]}),r.jsx(f.Z,{className:"w-8 h-8 text-orange-600"})]})})}),r.jsx(n.Zb,{children:r.jsx(n.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Total Amount"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(0,w.xG)(V.totalAmount)})]}),r.jsx(v.Z,{className:"w-8 h-8 text-green-600"})]})})}),r.jsx(n.Zb,{children:r.jsx(n.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Pending Amount"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(0,w.xG)(V.pendingAmount)})]}),r.jsx(y.Z,{className:"w-8 h-8 text-red-600"})]})})})]}),r.jsx(n.Zb,{children:r.jsx(n.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r.jsx(N.Z,{className:"w-4 h-4 text-gray-400"})}),r.jsx(d.I,{placeholder:"Search bills...",value:S,onChange:e=>A(e.target.value),className:"pl-10"})]}),r.jsx(o.P,{value:G,onChange:e=>M(e.target.value),options:O})]})})}),(0,r.jsxs)(n.Zb,{children:[r.jsx(n.Ol,{children:(0,r.jsxs)(n.ll,{children:["All Bills (",K.length,")"]})}),r.jsx(n.aY,{children:k?r.jsx("div",{className:"text-center py-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"})}):K.length>0?(0,r.jsxs)(m.iA,{children:[r.jsx(m.xD,{children:(0,r.jsxs)(m.SC,{children:[r.jsx(m.ss,{children:"User"}),r.jsx(m.ss,{children:"Description"}),r.jsx(m.ss,{children:"Amount"}),r.jsx(m.ss,{children:"Due Date"}),r.jsx(m.ss,{children:"Status"}),r.jsx(m.ss,{children:"Actions"})]})}),r.jsx(m.RM,{children:K.map(s=>(0,r.jsxs)(m.SC,{children:[r.jsx(m.pj,{children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:r.jsx("span",{className:"text-sm font-medium text-primary-700",children:(s.user?.name?.charAt(0)??"?").toUpperCase()})}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:s.user?.name??"Unknown"}),r.jsx("p",{className:"text-sm text-gray-500",children:s.user?.flatNumber??"-"})]})]})}),r.jsx(m.pj,{children:s.description}),r.jsx(m.pj,{children:(0,w.xG)(s.amount)}),r.jsx(m.pj,{children:(0,w.p6)(s.dueDate)}),r.jsx(m.pj,{children:r.jsx(u.C,{variant:Q(s.status),children:s.status})}),r.jsx(m.pj,{children:e.role===h.i4.RESIDENT&&s.status===h.bG.PENDING&&r.jsx(c.z,{variant:"outline",size:"sm",onClick:()=>H(s),children:"Pay Now"})})]},s._id))})]}):r.jsx("div",{className:"text-center py-8 text-gray-500",children:"No bills found"})})]}),r.jsx(x.u,{isOpen:I,onClose:()=>U(!1),title:"Pay Bill",size:"md",children:B&&(0,r.jsxs)("form",{onSubmit:Y,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[r.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Bill Details"}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"User:"})," ",B.user?.name]}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"Description:"})," ",B.description]}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"Amount:"})," ",(0,w.xG)(B.amount)]}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"Due Date:"})," ",(0,w.p6)(B.dueDate)]})]}),r.jsx(d.I,{label:"Amount",type:"number",value:L.amount,onChange:e=>z(s=>({...s,amount:e.target.value})),required:!0}),r.jsx(d.I,{label:"Gateway Reference",value:L.gatewayRef,onChange:e=>z(s=>({...s,gatewayRef:e.target.value})),required:!0}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[r.jsx(c.z,{variant:"outline",type:"button",onClick:()=>U(!1),children:"Cancel"}),r.jsx(c.z,{type:"submit",children:"Process Payment"})]})]})}),s("bills:write")&&r.jsx(x.u,{isOpen:Z,onClose:()=>_(!1),title:"Generate Bills",size:"md",children:(0,r.jsxs)("form",{onSubmit:J,className:"space-y-4",children:[r.jsx(d.I,{label:"Billing Period Start",type:"date",value:F.billingPeriodStart,onChange:e=>T(s=>({...s,billingPeriodStart:e.target.value})),required:!0}),r.jsx(d.I,{label:"Billing Period End",type:"date",value:F.billingPeriodEnd,onChange:e=>T(s=>({...s,billingPeriodEnd:e.target.value})),required:!0}),r.jsx(d.I,{label:"Amount",type:"number",value:F.amount,onChange:e=>T(s=>({...s,amount:Number(e.target.value)})),required:!0}),r.jsx(o.P,{label:"Select Residents",multiple:!0,options:D.map(e=>({value:e._id,label:e.name})),value:F.selectedUsers,onChange:e=>{let s=Array.from(e.target.selectedOptions).map(e=>e.value);T(e=>({...e,selectedUsers:s}))}}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[r.jsx(c.z,{variant:"outline",type:"button",onClick:()=>_(!1),children:"Cancel"}),r.jsx(c.z,{type:"submit",children:"Generate Bills"})]})]})})]})}):r.jsx(i.A,{children:r.jsx("div",{className:"flex items-center justify-center h-64",children:r.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})})})}},342:(e,s,t)=>{"use strict";t.d(s,{I:()=>a});var r=t(2295);t(3729);var l=t(1453);let a=({label:e,error:s,helperText:t,className:a,id:i,...n})=>{let c=i||`input-${Math.random().toString(36).substr(2,9)}`;return(0,r.jsxs)("div",{className:"space-y-2",children:[e&&r.jsx("label",{htmlFor:c,className:"block text-sm font-medium text-gray-700",children:e}),r.jsx("input",{id:c,className:(0,l.cn)("w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",s&&"border-red-500 focus:ring-red-500",a),...n}),s&&r.jsx("p",{className:"text-sm text-red-600",children:s}),t&&!s&&r.jsx("p",{className:"text-sm text-gray-500",children:t})]})}},2522:(e,s,t)=>{"use strict";t.d(s,{u:()=>n});var r=t(2295),l=t(3729),a=t(1453),i=t(4513);let n=({isOpen:e,onClose:s,title:t,children:n,size:c="md"})=>((0,l.useEffect)(()=>{let t=e=>{"Escape"===e.key&&s()};return e&&(document.addEventListener("keydown",t),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",t),document.body.style.overflow="unset"}},[e,s]),e)?r.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,r.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:s}),(0,r.jsxs)("div",{className:(0,a.cn)("relative bg-white rounded-lg shadow-xl w-full",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[c]),children:[t&&(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),r.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:r.jsx(i.Z,{className:"h-5 w-5"})})]}),r.jsx("div",{className:"p-6",children:n})]})]})}):null},8649:(e,s,t)=>{"use strict";t.d(s,{P:()=>a});var r=t(2295);t(3729);var l=t(1453);let a=({label:e,error:s,helperText:t,options:a,className:i,id:n,...c})=>{let d=n||`select-${Math.random().toString(36).substr(2,9)}`;return(0,r.jsxs)("div",{className:"space-y-2",children:[e&&r.jsx("label",{htmlFor:d,className:"block text-sm font-medium text-gray-700",children:e}),r.jsx("select",{id:d,className:(0,l.cn)("w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",s&&"border-red-500 focus:ring-red-500",i),...c,children:a.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))}),s&&r.jsx("p",{className:"text-sm text-red-600",children:s}),t&&!s&&r.jsx("p",{className:"text-sm text-gray-500",children:t})]})}},9865:(e,s,t)=>{"use strict";t.d(s,{RM:()=>n,SC:()=>c,iA:()=>a,pj:()=>o,ss:()=>d,xD:()=>i});var r=t(2295);t(3729);var l=t(1453);let a=({children:e,className:s,...t})=>r.jsx("div",{className:"overflow-x-auto",children:r.jsx("table",{className:(0,l.cn)("w-full border-collapse",s),...t,children:e})}),i=({children:e,className:s,...t})=>r.jsx("thead",{className:(0,l.cn)("bg-gray-50",s),...t,children:e}),n=({children:e,className:s,...t})=>r.jsx("tbody",{className:(0,l.cn)("bg-white divide-y divide-gray-200",s),...t,children:e}),c=({children:e,className:s,...t})=>r.jsx("tr",{className:(0,l.cn)("hover:bg-gray-50 transition-colors",s),...t,children:e}),d=({children:e,className:s,...t})=>r.jsx("th",{className:(0,l.cn)("px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",s),...t,children:e}),o=({children:e,className:s,...t})=>r.jsx("td",{className:(0,l.cn)("px-4 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-200",s),...t,children:e})},1456:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>a,__esModule:()=>l,default:()=>i});let r=(0,t(6843).createProxy)(String.raw`C:\Users\Mahi\Downloads\Habitat\habitat-frontend\src\app\bills\page.tsx`),{__esModule:l,$$typeof:a}=r,i=r.default}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[550,694,783,638,328],()=>t(8707));module.exports=r})();