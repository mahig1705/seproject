(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{9617:function(e,s,r){"use strict";r.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(2898).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},9883:function(e,s,r){"use strict";r.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(2898).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},1138:function(e,s,r){"use strict";r.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,r(2898).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},5898:function(e,s,r){Promise.resolve().then(r.bind(r,5442))},5442:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return g}});var a=r(7437),t=r(2265),l=r(3779),n=r(3414),i=r(7418),c=r(6651),o=r(2278),d=r(9173),u=r(8584),h=r(492),m=r(200),x=r(9883),f=r(9617),p=r(1138),j=r(5925),v=r(1633),b=r(4494);function g(){let{hasPermission:e}=(0,l.useAuth)(),[s,r]=(0,t.useState)([]),[g,y]=(0,t.useState)(!0),[N,w]=(0,t.useState)(""),[C,E]=(0,t.useState)(""),[k,S]=(0,t.useState)(!1),[I,D]=(0,t.useState)(!1),[A,M]=(0,t.useState)(null),[T,U]=(0,t.useState)({name:"",email:"",phone:"",role:b.i4.RESIDENT,flatNumber:"",password:""}),P=[{value:b.i4.ADMIN,label:"Admin"},{value:b.i4.COMMITTEE,label:"Committee"},{value:b.i4.RESIDENT,label:"Resident"},{value:b.i4.TENANT,label:"Tenant"},{value:b.i4.SECURITY,label:"Security"},{value:b.i4.TECHNICIAN,label:"Technician"}];(0,t.useEffect)(()=>{e("users:read")&&Z()},[]);let Z=async()=>{y(!0),console.log("\uD83D\uDD0D Fetching users...");try{let e=await v.E.getUsers();console.log("✅ API response:",e),(null==e?void 0:e.data)?(r(e.data),console.log("\uD83D\uDC65 Users loaded:",e.data.length)):console.warn("⚠️ Unexpected users response format:",e)}catch(s){var e;console.error("❌ Failed to load users:",(null==s?void 0:null===(e=s.response)||void 0===e?void 0:e.data)||s.message)}finally{y(!1),console.log("⏹️ Fetch users completed")}},F=()=>{U({name:"",email:"",phone:"",role:b.i4.RESIDENT,flatNumber:"",password:""})},R=()=>!T.name.trim()||T.name.length<2?(j.default.error("Name must be at least 2 characters"),!1):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(T.email)?T.phone&&!/^\d{10}$/.test(T.phone)?(j.default.error("Phone number must be 10 digits"),!1):T.role?!k||!!T.password.trim()||(j.default.error("Password is required for new users"),!1):(j.default.error("Please select a role"),!1):(j.default.error("Enter a valid email address"),!1),z=async e=>{if(e.preventDefault(),R()){console.log("\uD83D\uDE80 Sending user create request with data:",T);try{let e=await v.E.createUser(T);console.log("✅ Create user response:",e),j.default.success("User created successfully"),S(!1),F(),Z()}catch(e){var s;console.error("❌ Failed to create user:",(null==e?void 0:null===(s=e.response)||void 0===s?void 0:s.data)||e),j.default.error("Failed to create user")}}},q=async e=>{if(e.preventDefault(),R())try{await v.E.updateUser(null==A?void 0:A._id,T),j.default.success("User updated successfully"),D(!1),M(null),F(),Z()}catch(e){j.default.error("Failed to update user")}},_=async e=>{if(confirm("Delete this user permanently?"))try{await v.E.deleteUser(e),j.default.success("User deleted"),Z()}catch(e){j.default.error("Failed to delete user")}},L=e=>{M(e),U({name:e.name,email:e.email,phone:e.phone||"",role:e.role,flatNumber:e.flatNumber||"",password:""}),D(!0)},O=s.filter(e=>{let s=e.name.toLowerCase().includes(N.toLowerCase())||e.email.toLowerCase().includes(N.toLowerCase()),r=!C||e.role===C;return s&&r}),H=e=>{switch(e){case b.i4.ADMIN:return"danger";case b.i4.COMMITTEE:return"info";case b.i4.RESIDENT:return"success";case b.i4.TENANT:return"warning";default:return"default"}};return(0,a.jsxs)(n.A,{children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Users"}),e("users:write")&&(0,a.jsxs)(c.z,{onClick:()=>S(!0),children:[(0,a.jsx)(x.Z,{className:"w-4 h-4 mr-2"}),"Add User"]})]}),(0,a.jsx)(i.Zb,{children:(0,a.jsxs)(i.aY,{className:"p-4 grid md:grid-cols-3 gap-4",children:[(0,a.jsx)(o.I,{placeholder:"Search users...",value:N,onChange:e=>w(e.target.value)}),(0,a.jsx)(d.P,{value:C,onChange:e=>E(e.target.value),options:[{value:"",label:"All Roles"},...P]})]})}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsx)(i.Ol,{children:(0,a.jsxs)(i.ll,{children:["All Users (",O.length,")"]})}),(0,a.jsx)(i.aY,{children:g?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("div",{className:"h-8 w-8 border-2 border-primary-500 rounded-full border-t-transparent animate-spin mx-auto"})}):(0,a.jsxs)(m.iA,{children:[(0,a.jsx)(m.xD,{children:(0,a.jsxs)(m.SC,{children:[(0,a.jsx)(m.ss,{children:"Name"}),(0,a.jsx)(m.ss,{children:"Email"}),(0,a.jsx)(m.ss,{children:"Phone"}),(0,a.jsx)(m.ss,{children:"Role"}),(0,a.jsx)(m.ss,{children:"Flat"}),(0,a.jsx)(m.ss,{children:"Status"}),(0,a.jsx)(m.ss,{children:"Actions"})]})}),(0,a.jsx)(m.RM,{children:O.map(e=>(0,a.jsxs)(m.SC,{children:[(0,a.jsx)(m.pj,{children:e.name}),(0,a.jsx)(m.pj,{children:e.email}),(0,a.jsx)(m.pj,{children:e.phone||"-"}),(0,a.jsx)(m.pj,{children:(0,a.jsx)(u.C,{variant:H(e.role),children:e.role})}),(0,a.jsx)(m.pj,{children:e.flatNumber||"-"}),(0,a.jsx)(m.pj,{children:(0,a.jsx)(u.C,{variant:e.isActive?"success":"danger",children:e.isActive?"Active":"Inactive"})}),(0,a.jsx)(m.pj,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c.z,{size:"sm",variant:"outline",onClick:()=>L(e),children:(0,a.jsx)(f.Z,{className:"w-4 h-4"})}),(0,a.jsx)(c.z,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",onClick:()=>_(e._id),children:(0,a.jsx)(p.Z,{className:"w-4 h-4"})})]})})]},e._id))})]})})]})]}),(0,a.jsx)(h.u,{isOpen:k,onClose:()=>S(!1),title:"Add User",children:(0,a.jsxs)("form",{onSubmit:z,className:"space-y-4",children:[(0,a.jsx)(o.I,{label:"Name",value:T.name,onChange:e=>U({...T,name:e.target.value}),required:!0}),(0,a.jsx)(o.I,{label:"Email",type:"email",value:T.email,onChange:e=>U({...T,email:e.target.value}),required:!0}),(0,a.jsx)(o.I,{label:"Password",type:"password",value:T.password,onChange:e=>U({...T,password:e.target.value}),required:!0}),(0,a.jsx)(o.I,{label:"Phone",value:T.phone,onChange:e=>U({...T,phone:e.target.value})}),(0,a.jsx)(d.P,{label:"Role",value:T.role,onChange:e=>U({...T,role:e.target.value}),options:P}),(0,a.jsx)(o.I,{label:"Flat Number",value:T.flatNumber,onChange:e=>U({...T,flatNumber:e.target.value})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(c.z,{variant:"outline",type:"button",onClick:()=>S(!1),children:"Cancel"}),(0,a.jsx)(c.z,{type:"submit",children:"Save"})]})]})}),(0,a.jsx)(h.u,{isOpen:I,onClose:()=>D(!1),title:"Edit User",children:(0,a.jsxs)("form",{onSubmit:q,className:"space-y-4",children:[(0,a.jsx)(o.I,{label:"Name",value:T.name,onChange:e=>U({...T,name:e.target.value}),required:!0}),(0,a.jsx)(o.I,{label:"Email",type:"email",value:T.email,onChange:e=>U({...T,email:e.target.value}),required:!0}),(0,a.jsx)(o.I,{label:"Phone",value:T.phone,onChange:e=>U({...T,phone:e.target.value})}),(0,a.jsx)(d.P,{label:"Role",value:T.role,onChange:e=>U({...T,role:e.target.value}),options:P}),(0,a.jsx)(o.I,{label:"Flat Number",value:T.flatNumber,onChange:e=>U({...T,flatNumber:e.target.value})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(c.z,{variant:"outline",type:"button",onClick:()=>D(!1),children:"Cancel"}),(0,a.jsx)(c.z,{type:"submit",children:"Update"})]})]})})]})}},2278:function(e,s,r){"use strict";r.d(s,{I:function(){return l}});var a=r(7437);r(2265);var t=r(2169);let l=e=>{let{label:s,error:r,helperText:l,className:n,id:i,...c}=e,o=i||"input-".concat(Math.random().toString(36).substr(2,9));return(0,a.jsxs)("div",{className:"space-y-2",children:[s&&(0,a.jsx)("label",{htmlFor:o,className:"block text-sm font-medium text-gray-700",children:s}),(0,a.jsx)("input",{id:o,className:(0,t.cn)("w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",r&&"border-red-500 focus:ring-red-500",n),...c}),r&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:r}),l&&!r&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:l})]})}},492:function(e,s,r){"use strict";r.d(s,{u:function(){return i}});var a=r(7437),t=r(2265),l=r(2169),n=r(2549);let i=e=>{let{isOpen:s,onClose:r,title:i,children:c,size:o="md"}=e;return((0,t.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r()};return s&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[s,r]),s)?(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:r}),(0,a.jsxs)("div",{className:(0,l.cn)("relative bg-white rounded-lg shadow-xl w-full",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[o]),children:[i&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:i}),(0,a.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(n.Z,{className:"h-5 w-5"})})]}),(0,a.jsx)("div",{className:"p-6",children:c})]})]})}):null}},9173:function(e,s,r){"use strict";r.d(s,{P:function(){return l}});var a=r(7437);r(2265);var t=r(2169);let l=e=>{let{label:s,error:r,helperText:l,options:n,className:i,id:c,...o}=e,d=c||"select-".concat(Math.random().toString(36).substr(2,9));return(0,a.jsxs)("div",{className:"space-y-2",children:[s&&(0,a.jsx)("label",{htmlFor:d,className:"block text-sm font-medium text-gray-700",children:s}),(0,a.jsx)("select",{id:d,className:(0,t.cn)("w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",r&&"border-red-500 focus:ring-red-500",i),...o,children:n.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))}),r&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:r}),l&&!r&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:l})]})}},200:function(e,s,r){"use strict";r.d(s,{RM:function(){return i},SC:function(){return c},iA:function(){return l},pj:function(){return d},ss:function(){return o},xD:function(){return n}});var a=r(7437);r(2265);var t=r(2169);let l=e=>{let{children:s,className:r,...l}=e;return(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)("table",{className:(0,t.cn)("w-full border-collapse",r),...l,children:s})})},n=e=>{let{children:s,className:r,...l}=e;return(0,a.jsx)("thead",{className:(0,t.cn)("bg-gray-50",r),...l,children:s})},i=e=>{let{children:s,className:r,...l}=e;return(0,a.jsx)("tbody",{className:(0,t.cn)("bg-white divide-y divide-gray-200",r),...l,children:s})},c=e=>{let{children:s,className:r,...l}=e;return(0,a.jsx)("tr",{className:(0,t.cn)("hover:bg-gray-50 transition-colors",r),...l,children:s})},o=e=>{let{children:s,className:r,...l}=e;return(0,a.jsx)("th",{className:(0,t.cn)("px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",r),...l,children:s})},d=e=>{let{children:s,className:r,...l}=e;return(0,a.jsx)("td",{className:(0,t.cn)("px-4 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-200",r),...l,children:s})}}},function(e){e.O(0,[358,651,396,462,865,971,938,744],function(){return e(e.s=5898)}),_N_E=e.O()}]);