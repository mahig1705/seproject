(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[23],{1298:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,t(2898).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},5817:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,t(2898).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},9883:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,t(2898).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},1827:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,t(2898).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},2484:function(e,s,t){Promise.resolve().then(t.bind(t,5420))},5420:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return D}});var l=t(7437),r=t(2265),n=t(3779),a=t(3414),i=t(7418),c=t(6651),d=t(2278),o=t(9173),u=t(8584),x=t(492),m=t(200),h=t(4494),j=t(1633);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let p=(0,t(2898).Z)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);var f=t(9883),b=t(5817),y=t(1738),g=t(8203),v=t(1298),N=t(1827),w=t(2169),E=t(5925);function D(){var e;let{user:s,hasPermission:t}=(0,n.useAuth)(),[D,C]=(0,r.useState)([]),[k,P]=(0,r.useState)([]),[S,A]=(0,r.useState)(!0),[G,I]=(0,r.useState)(""),[M,Z]=(0,r.useState)(""),[B,U]=(0,r.useState)(!1),[R,L]=(0,r.useState)(!1),[F,z]=(0,r.useState)(null),[O,_]=(0,r.useState)({amount:"",gatewayRef:""}),[q,T]=(0,r.useState)({billingPeriodStart:"",billingPeriodEnd:"",amount:0,selectedUsers:[]}),Y=[{value:"",label:"All Status"},{value:h.bG.PENDING,label:"Pending"},{value:h.bG.COMPLETED,label:"Completed"},{value:h.bG.FAILED,label:"Failed"},{value:h.bG.REFUNDED,label:"Refunded"}];(0,r.useEffect)(()=>{(async()=>{if(s)try{A(!0);let e=s.role===h.i4.ADMIN||s.role===h.i4.COMMITTEE?{}:{userId:s._id},t=await j.E.getBills(e);console.log("\uD83D\uDCE6 Bills data from backend:",t);let l=t.map(e=>({...e,status:e.status||h.bG.PENDING,user:e.user||{name:"Unknown",flatNumber:"-"}}));if(C(l),s.role===h.i4.ADMIN||s.role===h.i4.COMMITTEE){let e=await j.E.getUsers();P(e.data||[])}}catch(e){console.error("❌ Failed to fetch bills:",e),E.default.error("Failed to load bills")}finally{A(!1)}})()},[s]);let H=async()=>{if(s)try{A(!0);let e=s.role===h.i4.ADMIN||s.role===h.i4.COMMITTEE?{}:{userId:s._id},t=await j.E.getBills(e),l=(Array.isArray(t)?t:[]).map(e=>({...e,status:e.status||h.bG.PENDING,user:e.user||{name:"Unknown",flatNumber:"-"}}));C(l)}catch(e){console.error("❌ Failed to fetch bills:",e),E.default.error("Failed to load bills")}finally{A(!1)}},J=e=>{z(e),_({amount:e.amount.toString(),gatewayRef:""}),U(!0)},K=async e=>{if(e.preventDefault(),F)try{await j.E.payBill(F._id,Number(O.amount),O.gatewayRef),E.default.success("Payment processed successfully"),U(!1),H()}catch(e){E.default.error("Failed to process payment")}},Q=()=>{T({billingPeriodStart:"",billingPeriodEnd:"",amount:0,selectedUsers:[]})},V=async e=>{if(e.preventDefault(),!q.selectedUsers.length){E.default.error("Select at least one resident");return}try{let e=q.selectedUsers.map(e=>({user:e,description:"Maintenance bill for period ".concat(q.billingPeriodStart," to ").concat(q.billingPeriodEnd),amount:q.amount,dueDate:q.billingPeriodEnd}));await j.E.generateBills(e),E.default.success("Bills generated successfully"),L(!1),Q(),H()}catch(e){E.default.error("Failed to generate bills")}},W=D.filter(e=>{var s,t,l;let r=(null===(t=e.user)||void 0===t?void 0:null===(s=t.name)||void 0===s?void 0:s.toLowerCase())||"",n=((null===(l=e.description)||void 0===l?void 0:l.toLowerCase())||"").includes(G.toLowerCase())||r.includes(G.toLowerCase()),a=!M||e.status===M;return n&&a}),X=e=>{switch(e){case h.bG.PENDING:return"warning";case h.bG.COMPLETED:return"success";case h.bG.FAILED:return"danger";case h.bG.REFUNDED:return"info";default:return"default"}},$=(()=>{let e=D.length;return{totalBills:e,pendingBills:D.filter(e=>e.status===h.bG.PENDING).length,totalAmount:D.reduce((e,s)=>e+(s.amount||0),0),pendingAmount:D.filter(e=>e.status===h.bG.PENDING).reduce((e,s)=>e+(s.amount||0),0)}})();return s?(0,l.jsx)(a.A,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Bills"}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsxs)(c.z,{variant:"outline",onClick:H,children:[(0,l.jsx)(p,{className:"w-4 h-4 mr-2"})," Refresh"]}),t("bills:write")&&(0,l.jsxs)(c.z,{onClick:()=>L(!0),children:[(0,l.jsx)(f.Z,{className:"w-4 h-4 mr-2"})," Generate Bills"]}),(0,l.jsxs)(c.z,{variant:"outline",onClick:()=>{if(!D.length)return E.default.error("No bills to export");let e=["User,Description,Amount,Due Date,Status",...D.map(e=>{var s,t;return['"'.concat(null!==(t=null===(s=e.user)||void 0===s?void 0:s.name)&&void 0!==t?t:"Unknown",'"'),'"'.concat(e.description,'"'),e.amount,(0,w.p6)(e.dueDate),e.status].join(",")})].join("\n"),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(s),t.setAttribute("download","bills_export.csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t),E.default.success("Bills exported successfully")},children:[(0,l.jsx)(b.Z,{className:"w-4 h-4 mr-2"})," Export"]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,l.jsx)(i.Zb,{children:(0,l.jsx)(i.aY,{className:"p-6",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Total Bills"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:$.totalBills})]}),(0,l.jsx)(y.Z,{className:"w-8 h-8 text-blue-600"})]})})}),(0,l.jsx)(i.Zb,{children:(0,l.jsx)(i.aY,{className:"p-6",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Pending Bills"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:$.pendingBills})]}),(0,l.jsx)(g.Z,{className:"w-8 h-8 text-orange-600"})]})})}),(0,l.jsx)(i.Zb,{children:(0,l.jsx)(i.aY,{className:"p-6",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Total Amount"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(0,w.xG)($.totalAmount)})]}),(0,l.jsx)(v.Z,{className:"w-8 h-8 text-green-600"})]})})}),(0,l.jsx)(i.Zb,{children:(0,l.jsx)(i.aY,{className:"p-6",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Pending Amount"}),(0,l.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(0,w.xG)($.pendingAmount)})]}),(0,l.jsx)(y.Z,{className:"w-8 h-8 text-red-600"})]})})})]}),(0,l.jsx)(i.Zb,{children:(0,l.jsx)(i.aY,{className:"p-6",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,l.jsx)(N.Z,{className:"w-4 h-4 text-gray-400"})}),(0,l.jsx)(d.I,{placeholder:"Search bills...",value:G,onChange:e=>I(e.target.value),className:"pl-10"})]}),(0,l.jsx)(o.P,{value:M,onChange:e=>Z(e.target.value),options:Y})]})})}),(0,l.jsxs)(i.Zb,{children:[(0,l.jsx)(i.Ol,{children:(0,l.jsxs)(i.ll,{children:["All Bills (",W.length,")"]})}),(0,l.jsx)(i.aY,{children:S?(0,l.jsx)("div",{className:"text-center py-8",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"})}):W.length>0?(0,l.jsxs)(m.iA,{children:[(0,l.jsx)(m.xD,{children:(0,l.jsxs)(m.SC,{children:[(0,l.jsx)(m.ss,{children:"User"}),(0,l.jsx)(m.ss,{children:"Description"}),(0,l.jsx)(m.ss,{children:"Amount"}),(0,l.jsx)(m.ss,{children:"Due Date"}),(0,l.jsx)(m.ss,{children:"Status"}),(0,l.jsx)(m.ss,{children:"Actions"})]})}),(0,l.jsx)(m.RM,{children:W.map(e=>{var t,r,n,a,i,d,o;return(0,l.jsxs)(m.SC,{children:[(0,l.jsx)(m.pj,{children:(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-sm font-medium text-primary-700",children:(null!==(i=null===(r=e.user)||void 0===r?void 0:null===(t=r.name)||void 0===t?void 0:t.charAt(0))&&void 0!==i?i:"?").toUpperCase()})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium text-gray-900",children:null!==(d=null===(n=e.user)||void 0===n?void 0:n.name)&&void 0!==d?d:"Unknown"}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:null!==(o=null===(a=e.user)||void 0===a?void 0:a.flatNumber)&&void 0!==o?o:"-"})]})]})}),(0,l.jsx)(m.pj,{children:e.description}),(0,l.jsx)(m.pj,{children:(0,w.xG)(e.amount)}),(0,l.jsx)(m.pj,{children:(0,w.p6)(e.dueDate)}),(0,l.jsx)(m.pj,{children:(0,l.jsx)(u.C,{variant:X(e.status),children:e.status})}),(0,l.jsx)(m.pj,{children:s.role===h.i4.RESIDENT&&e.status===h.bG.PENDING&&(0,l.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>J(e),children:"Pay Now"})})]},e._id)})})]}):(0,l.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No bills found"})})]}),(0,l.jsx)(x.u,{isOpen:B,onClose:()=>U(!1),title:"Pay Bill",size:"md",children:F&&(0,l.jsxs)("form",{onSubmit:K,className:"space-y-4",children:[(0,l.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,l.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Bill Details"}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"User:"})," ",null===(e=F.user)||void 0===e?void 0:e.name]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Description:"})," ",F.description]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Amount:"})," ",(0,w.xG)(F.amount)]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Due Date:"})," ",(0,w.p6)(F.dueDate)]})]}),(0,l.jsx)(d.I,{label:"Amount",type:"number",value:O.amount,onChange:e=>_(s=>({...s,amount:e.target.value})),required:!0}),(0,l.jsx)(d.I,{label:"Gateway Reference",value:O.gatewayRef,onChange:e=>_(s=>({...s,gatewayRef:e.target.value})),required:!0}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)(c.z,{variant:"outline",type:"button",onClick:()=>U(!1),children:"Cancel"}),(0,l.jsx)(c.z,{type:"submit",children:"Process Payment"})]})]})}),t("bills:write")&&(0,l.jsx)(x.u,{isOpen:R,onClose:()=>L(!1),title:"Generate Bills",size:"md",children:(0,l.jsxs)("form",{onSubmit:V,className:"space-y-4",children:[(0,l.jsx)(d.I,{label:"Billing Period Start",type:"date",value:q.billingPeriodStart,onChange:e=>T(s=>({...s,billingPeriodStart:e.target.value})),required:!0}),(0,l.jsx)(d.I,{label:"Billing Period End",type:"date",value:q.billingPeriodEnd,onChange:e=>T(s=>({...s,billingPeriodEnd:e.target.value})),required:!0}),(0,l.jsx)(d.I,{label:"Amount",type:"number",value:q.amount,onChange:e=>T(s=>({...s,amount:Number(e.target.value)})),required:!0}),(0,l.jsx)(o.P,{label:"Select Residents",multiple:!0,options:k.map(e=>({value:e._id,label:e.name})),value:q.selectedUsers,onChange:e=>{let s=Array.from(e.target.selectedOptions).map(e=>e.value);T(e=>({...e,selectedUsers:s}))}}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)(c.z,{variant:"outline",type:"button",onClick:()=>L(!1),children:"Cancel"}),(0,l.jsx)(c.z,{type:"submit",children:"Generate Bills"})]})]})})]})}):(0,l.jsx)(a.A,{children:(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})})})}},2278:function(e,s,t){"use strict";t.d(s,{I:function(){return n}});var l=t(7437);t(2265);var r=t(2169);let n=e=>{let{label:s,error:t,helperText:n,className:a,id:i,...c}=e,d=i||"input-".concat(Math.random().toString(36).substr(2,9));return(0,l.jsxs)("div",{className:"space-y-2",children:[s&&(0,l.jsx)("label",{htmlFor:d,className:"block text-sm font-medium text-gray-700",children:s}),(0,l.jsx)("input",{id:d,className:(0,r.cn)("w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",t&&"border-red-500 focus:ring-red-500",a),...c}),t&&(0,l.jsx)("p",{className:"text-sm text-red-600",children:t}),n&&!t&&(0,l.jsx)("p",{className:"text-sm text-gray-500",children:n})]})}},492:function(e,s,t){"use strict";t.d(s,{u:function(){return i}});var l=t(7437),r=t(2265),n=t(2169),a=t(2549);let i=e=>{let{isOpen:s,onClose:t,title:i,children:c,size:d="md"}=e;return((0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t()};return s&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[s,t]),s)?(0,l.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,l.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t}),(0,l.jsxs)("div",{className:(0,n.cn)("relative bg-white rounded-lg shadow-xl w-full",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[d]),children:[i&&(0,l.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:i}),(0,l.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,l.jsx)(a.Z,{className:"h-5 w-5"})})]}),(0,l.jsx)("div",{className:"p-6",children:c})]})]})}):null}},9173:function(e,s,t){"use strict";t.d(s,{P:function(){return n}});var l=t(7437);t(2265);var r=t(2169);let n=e=>{let{label:s,error:t,helperText:n,options:a,className:i,id:c,...d}=e,o=c||"select-".concat(Math.random().toString(36).substr(2,9));return(0,l.jsxs)("div",{className:"space-y-2",children:[s&&(0,l.jsx)("label",{htmlFor:o,className:"block text-sm font-medium text-gray-700",children:s}),(0,l.jsx)("select",{id:o,className:(0,r.cn)("w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",t&&"border-red-500 focus:ring-red-500",i),...d,children:a.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))}),t&&(0,l.jsx)("p",{className:"text-sm text-red-600",children:t}),n&&!t&&(0,l.jsx)("p",{className:"text-sm text-gray-500",children:n})]})}},200:function(e,s,t){"use strict";t.d(s,{RM:function(){return i},SC:function(){return c},iA:function(){return n},pj:function(){return o},ss:function(){return d},xD:function(){return a}});var l=t(7437);t(2265);var r=t(2169);let n=e=>{let{children:s,className:t,...n}=e;return(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsx)("table",{className:(0,r.cn)("w-full border-collapse",t),...n,children:s})})},a=e=>{let{children:s,className:t,...n}=e;return(0,l.jsx)("thead",{className:(0,r.cn)("bg-gray-50",t),...n,children:s})},i=e=>{let{children:s,className:t,...n}=e;return(0,l.jsx)("tbody",{className:(0,r.cn)("bg-white divide-y divide-gray-200",t),...n,children:s})},c=e=>{let{children:s,className:t,...n}=e;return(0,l.jsx)("tr",{className:(0,r.cn)("hover:bg-gray-50 transition-colors",t),...n,children:s})},d=e=>{let{children:s,className:t,...n}=e;return(0,l.jsx)("th",{className:(0,r.cn)("px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",t),...n,children:s})},o=e=>{let{children:s,className:t,...n}=e;return(0,l.jsx)("td",{className:(0,r.cn)("px-4 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-200",t),...n,children:s})}}},function(e){e.O(0,[358,651,396,462,865,971,938,744],function(){return e(e.s=2484)}),_N_E=e.O()}]);