(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{6141:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,t(2898).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},6924:function(e,s,t){Promise.resolve().then(t.bind(t,7736))},7736:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return y}});var l=t(7437),i=t(2265),o=t(3779),a=t(3414),r=t(7418),n=t(8584),c=t(6651),d=t(5750),u=t(2894),g=t(1738),m=t(2527),x=t(6141),h=t(3021),f=t(4494),p=t(2169),N=t(1633),j=t(1396),b=t.n(j);function y(){var e;let{user:s,hasRole:t}=(0,o.useAuth)(),[j,y]=(0,i.useState)({totalUsers:0,totalIssues:0,totalBills:0,totalVisitors:0,activeVisitors:0,pendingIssues:0,pendingBills:0,recentNotices:[],recentIssues:[]}),[v,D]=(0,i.useState)(!0),[C,E]=(0,i.useState)(null);return((0,i.useEffect)(()=>{let e=async()=>{try{console.log("\uD83D\uDCCA Fetching dashboard data..."),D(!0),E(null);let[l,i]=await Promise.all([N.E.getNotices({limit:5}),N.E.getIssues({page:1,limit:5})]);console.log("✅ Notices:",l),console.log("✅ Recent Issues:",i);let o=0,a=0,r=0,n=0,c=0,d=0,u=0;if(t([f.i4.SECURITY])){let e=await N.E.getVisitors({page:1,limit:1e3});console.log("\uD83D\uDEAA Security - Visitors:",e),n=e.length,c=e.filter(e=>!e.outTime).length,console.log("✅ Security stats: total=".concat(n,", active=").concat(c))}if(t([f.i4.ADMIN,f.i4.COMMITTEE])){var e;let[s,t,l,i]=await Promise.all([N.E.getUsers(),N.E.getBills({page:1,limit:1e3}),N.E.getIssues({page:1,limit:1e3}),N.E.getVisitors({page:1,limit:1e3})]);console.log("\uD83D\uDC51 Admin/Committee - Users:",s),console.log("\uD83D\uDCB3 Admin/Committee - Bills:",t),console.log("\uD83D\uDD27 Admin/Committee - Issues:",l),console.log("\uD83D\uDEAA Admin/Committee - Visitors:",i),o=(null===(e=s.data)||void 0===e?void 0:e.length)||0,a=t.length,r=t.filter(e=>"Pending"===e.status).length,d=l.length,u=l.filter(e=>"open"===e.status).length,n=i.length,c=i.filter(e=>!e.outTime).length,console.log("✅ Admin/Committee stats:",{totalUsers:o,totalBills:a,pendingBills:r,totalIssues:d,pendingIssues:u,totalVisitors:n,activeVisitors:c})}if(t([f.i4.RESIDENT,f.i4.TENANT])){let e=null==s?void 0:s._id;if(!e)throw Error("User ID not found");let[t,l,i]=await Promise.all([N.E.getIssues({reporter:e,page:1,limit:1e3}),N.E.getBills({userId:e,page:1,limit:1e3}),N.E.getVisitors({flatNumber:null==s?void 0:s.flatNumber,page:1,limit:1e3})]);console.log("\uD83C\uDFE0 Resident/Tenant - Issues:",t),console.log("\uD83D\uDCB3 Resident/Tenant - Bills:",l),console.log("\uD83D\uDEAA Resident/Tenant - Visitors:",i),d=t.length,a=l.length,r=l.filter(e=>"Pending"===e.status).length,n=i.length,c=i.filter(e=>!e.outTime).length,console.log("✅ Resident/Tenant stats:",{totalIssues:d,totalBills:a,pendingBills:r,totalVisitors:n,activeVisitors:c})}y({totalUsers:o,totalBills:a,pendingBills:r,totalVisitors:n,activeVisitors:c,totalIssues:d,pendingIssues:u,recentNotices:l.data||[],recentIssues:i||[]}),console.log("\uD83D\uDCC8 Final dashboard stats:",{totalUsers:o,totalBills:a,pendingBills:r,totalVisitors:n,activeVisitors:c,totalIssues:d,pendingIssues:u})}catch(e){console.error("❌ Dashboard fetch error:",e),E(e.message||"Failed to load dashboard data")}finally{D(!1)}};s&&e()},[s,t]),C)?(0,l.jsx)(a.A,{children:(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(u.Z,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Dashboard"}),(0,l.jsx)("p",{className:"text-gray-600",children:C}),(0,l.jsx)(c.z,{onClick:()=>window.location.reload(),className:"mt-4",children:"Retry"})]})})}):v?(0,l.jsx)(a.A,{children:(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})})}):(0,l.jsx)(a.A,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"bg-gradient-to-r from-primary-600 to-primary-700 rounded-lg p-6 text-white",children:[(0,l.jsxs)("h1",{className:"text-2xl font-bold mb-2",children:["Welcome back, ",null==s?void 0:null===(e=s.name)||void 0===e?void 0:e.split(" ")[0],"!"]}),(0,l.jsx)("p",{className:"text-primary-100",children:"Here's what's happening in your society today."})]}),(0,l.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:(t([f.i4.ADMIN,f.i4.COMMITTEE])?[{title:"Total Users",value:j.totalUsers,icon:d.Z,color:"text-blue-600",bgColor:"bg-blue-100"},{title:"Total Issues",value:j.totalIssues,icon:u.Z,color:"text-orange-600",bgColor:"bg-orange-100"},{title:"Total Bills",value:j.totalBills,icon:g.Z,color:"text-green-600",bgColor:"bg-green-100"},{title:"Total Visitors",value:j.totalVisitors,icon:m.Z,color:"text-purple-600",bgColor:"bg-purple-100"}]:t([f.i4.RESIDENT,f.i4.TENANT])?[{title:"My Issues",value:j.totalIssues,icon:u.Z,color:"text-orange-600",bgColor:"bg-orange-100"},{title:"My Bills",value:j.totalBills,icon:g.Z,color:"text-green-600",bgColor:"bg-green-100"},{title:"Pending Bills",value:j.pendingBills,icon:x.Z,color:"text-red-600",bgColor:"bg-red-100"},{title:"My Visitors",value:j.totalVisitors,icon:m.Z,color:"text-purple-600",bgColor:"bg-purple-100"}]:t([f.i4.SECURITY])?[{title:"Today's Visitors",value:j.totalVisitors,icon:m.Z,color:"text-purple-600",bgColor:"bg-purple-100"},{title:"Active Visitors",value:j.activeVisitors,icon:x.Z,color:"text-blue-600",bgColor:"bg-blue-100"}]:[]).map((e,s)=>(0,l.jsx)(r.Zb,{className:"h-full",children:(0,l.jsx)(r.aY,{className:"p-6 flex flex-col justify-between",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-500",children:e.title}),(0,l.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:e.value})]}),(0,l.jsx)("div",{className:"p-3 rounded-full ".concat(e.bgColor),children:(0,l.jsx)(e.icon,{className:"w-6 h-6 ".concat(e.color)})})]})})},s))}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,l.jsxs)(r.Zb,{className:"h-full flex flex-col",children:[(0,l.jsx)(r.Ol,{children:(0,l.jsxs)(r.ll,{className:"flex items-center space-x-2",children:[(0,l.jsx)(h.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"Recent Notices"})]})}),(0,l.jsxs)(r.aY,{className:"flex-1 flex flex-col space-y-3",children:[j.recentNotices.length>0?j.recentNotices.map((e,s)=>(0,l.jsxs)("div",{className:"border-l-4 border-primary-500 pl-4",children:[(0,l.jsx)("h4",{className:"font-medium text-gray-900",children:e.title}),(0,l.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.content}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:(0,p.p6)(e.createdAt)})]},s)):(0,l.jsx)("p",{className:"text-gray-500 text-center py-4 flex-1 flex items-center justify-center",children:"No recent notices"}),(0,l.jsx)(b(),{href:"/notices",children:(0,l.jsx)(c.z,{variant:"outline",className:"w-full mt-auto",children:"View All Notices"})})]})]}),(0,l.jsxs)(r.Zb,{className:"h-full flex flex-col",children:[(0,l.jsx)(r.Ol,{children:(0,l.jsxs)(r.ll,{className:"flex items-center space-x-2",children:[(0,l.jsx)(u.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"Recent Issues"})]})}),(0,l.jsxs)(r.aY,{className:"flex-1 flex flex-col space-y-3",children:[j.recentIssues.length>0?j.recentIssues.map((e,s)=>(0,l.jsxs)("div",{className:"flex justify-between items-start p-3 bg-gray-50 rounded-lg",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-gray-900",children:e.title}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]}),(0,l.jsx)(n.C,{variant:"open"===e.status?"warning":"resolved"===e.status?"success":"info",children:e.status})]},s)):(0,l.jsx)("p",{className:"text-gray-500 text-center py-4 flex-1 flex items-center justify-center",children:"No recent issues"}),(0,l.jsx)(b(),{href:"/issues",children:(0,l.jsx)(c.z,{variant:"outline",className:"w-full mt-auto",children:"View All Issues"})})]})]})]})]})})}}},function(e){e.O(0,[358,651,396,462,865,971,938,744],function(){return e(e.s=6924)}),_N_E=e.O()}]);