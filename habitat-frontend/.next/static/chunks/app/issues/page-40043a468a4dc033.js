(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[521],{9617:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(2898).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},9883:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(2898).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},1827:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(2898).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},3396:function(e,s,t){Promise.resolve().then(t.bind(t,8191))},8191:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return w}});var a=t(7437),r=t(2265),n=t(3779),i=t(3414),l=t(7418),c=t(6651),d=t(2278),u=t(9173),o=t(4706),x=t(8584),h=t(492),m=t(200),p=t(4494),j=t(1633),g=t(9883),f=t(1827),v=t(2894),y=t(9617),b=t(2169),N=t(5925);function w(){let{hasPermission:e}=(0,n.useAuth)(),[s,t]=(0,r.useState)([]),[w,C]=(0,r.useState)(!0),[S,E]=(0,r.useState)(""),[k,I]=(0,r.useState)(""),[O,P]=(0,r.useState)(!1),[D,Z]=(0,r.useState)(!1),[_,A]=(0,r.useState)(null),[R,L]=(0,r.useState)([]),[z,$]=(0,r.useState)({title:"",description:"",status:p.d$.OPEN,images:[],technician:""}),M=[{value:"",label:"All Status"},{value:p.d$.OPEN,label:"Open"},{value:p.d$.IN_PROGRESS,label:"In Progress"},{value:p.d$.RESOLVED,label:"Resolved"},{value:p.d$.CLOSED,label:"Closed"}];(0,r.useEffect)(()=>{e("issues:read")&&(q(),F())},[]);let q=async()=>{try{C(!0);let e=await j.E.getIssues();t(e)}catch(e){N.default.error("Failed to fetch issues")}finally{C(!1)}},F=async()=>{try{let e=await j.E.getTechnicians();L(e)}catch(e){console.error("Failed to fetch technicians")}},T=async e=>{e.preventDefault();try{await j.E.createIssue({title:z.title,description:z.description,images:z.images,technician:z.technician}),N.default.success("Issue created successfully"),P(!1),Y(),q()}catch(e){N.default.error("Failed to create issue")}},U=async e=>{if(e.preventDefault(),_)try{await j.E.updateIssue(_._id,{...z,technician:z.technician}),N.default.success("Issue updated successfully"),Z(!1),A(null),Y(),q()}catch(e){N.default.error("Failed to update issue")}},Y=()=>{$({title:"",description:"",status:p.d$.OPEN,images:[],technician:""})},G=e=>{var s;A(e),$({title:e.title,description:e.description,status:e.status,images:e.images||[],technician:(null===(s=e.technician)||void 0===s?void 0:s._id)||""}),Z(!0)},V=(s||[]).filter(e=>{let s=e.title.toLowerCase().includes(S.toLowerCase())||e.description.toLowerCase().includes(S.toLowerCase()),t=!k||e.status===k,a=e.status!==p.d$.CLOSED;return s&&t&&a}),B=e=>{switch(e){case p.d$.OPEN:return"warning";case p.d$.IN_PROGRESS:return"info";case p.d$.RESOLVED:return"success";case p.d$.CLOSED:default:return"default"}};return e("issues:read")?(0,a.jsxs)(i.A,{children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Issues"}),e("issues:write")&&(0,a.jsxs)(c.z,{onClick:()=>P(!0),children:[(0,a.jsx)(g.Z,{className:"w-4 h-4 mr-2"})," Report Issue"]})]}),(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(d.I,{placeholder:"Search issues...",value:S,onChange:e=>E(e.target.value)}),(0,a.jsx)(f.Z,{className:"w-4 h-4 absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]}),(0,a.jsx)(u.P,{value:k,onChange:e=>I(e.target.value),options:M})]})})}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsxs)(l.ll,{children:["All Issues (",V.length,")"]})}),(0,a.jsx)(l.aY,{children:w?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"})}):(0,a.jsxs)(m.iA,{children:[(0,a.jsx)(m.xD,{children:(0,a.jsxs)(m.SC,{children:[(0,a.jsx)(m.ss,{children:"Title"}),(0,a.jsx)(m.ss,{children:"Description"}),(0,a.jsx)(m.ss,{children:"Reporter"}),(0,a.jsx)(m.ss,{children:"Assigned To"}),(0,a.jsx)(m.ss,{children:"Status"}),(0,a.jsx)(m.ss,{children:"Created"}),(0,a.jsx)(m.ss,{children:"Actions"})]})}),(0,a.jsx)(m.RM,{children:V.map(e=>{var s,t;return(0,a.jsxs)(m.SC,{children:[(0,a.jsx)(m.pj,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(v.Z,{className:"w-5 h-5 text-orange-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.title}),e.images&&e.images.length>0&&(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[e.images.length," image(s)"]})]})]})}),(0,a.jsx)(m.pj,{children:(0,a.jsx)("p",{className:"text-sm text-gray-600 max-w-xs truncate",children:e.description})}),(0,a.jsx)(m.pj,{children:(0,a.jsx)("span",{className:"text-sm text-gray-900",children:(null===(s=e.reporter)||void 0===s?void 0:s.name)||"Unassigned"})}),(0,a.jsx)(m.pj,{children:(0,a.jsx)("span",{className:"text-sm text-gray-900",children:(null===(t=e.technician)||void 0===t?void 0:t.name)||"Unassigned"})}),(0,a.jsx)(m.pj,{children:(0,a.jsx)(x.C,{variant:B(e.status),children:e.status.replace("_"," ")})}),(0,a.jsx)(m.pj,{children:(0,a.jsx)("span",{className:"text-sm text-gray-600",children:(0,b.p6)(e.createdAt)})}),(0,a.jsx)(m.pj,{children:(0,a.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>G(e),children:(0,a.jsx)(y.Z,{className:"w-4 h-4"})})})]},e._id)})})]})})]})]}),(0,a.jsx)(h.u,{isOpen:O,onClose:()=>P(!1),title:"Report New Issue",size:"lg",children:(0,a.jsxs)("form",{onSubmit:T,className:"space-y-4",children:[(0,a.jsx)(d.I,{label:"Title",value:z.title,onChange:e=>$(s=>({...s,title:e.target.value})),placeholder:"Brief description of the issue",required:!0}),(0,a.jsx)(o.g,{label:"Description",value:z.description,onChange:e=>$(s=>({...s,description:e.target.value})),placeholder:"Detailed description of the issue",rows:4,required:!0}),(0,a.jsx)(u.P,{label:"Assign To",value:z.technician,onChange:e=>$(s=>({...s,technician:e.target.value})),options:[{value:"",label:"Unassigned"},...(R||[]).map(e=>({value:e._id,label:e.name}))]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(c.z,{type:"button",variant:"outline",onClick:()=>P(!1),children:"Cancel"}),(0,a.jsx)(c.z,{type:"submit",children:"Report Issue"})]})]})}),(0,a.jsx)(h.u,{isOpen:D,onClose:()=>Z(!1),title:"Edit Issue",size:"lg",children:(0,a.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[(0,a.jsx)(d.I,{label:"Title",value:z.title,onChange:e=>$(s=>({...s,title:e.target.value})),required:!0}),(0,a.jsx)(o.g,{label:"Description",value:z.description,onChange:e=>$(s=>({...s,description:e.target.value})),rows:4,required:!0}),(0,a.jsx)(u.P,{label:"Assign To",value:z.technician,onChange:e=>$(s=>({...s,technician:e.target.value})),options:[{value:"",label:"Unassigned"},...(R||[]).map(e=>({value:e._id,label:e.name}))]}),(0,a.jsx)(u.P,{label:"Status",value:z.status,onChange:e=>$(s=>({...s,status:e.target.value})),options:M.filter(e=>""!==e.value)}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(c.z,{type:"button",variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),(0,a.jsx)(c.z,{type:"submit",children:"Update Issue"})]})]})})]}):(0,a.jsx)(i.A,{children:(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-gray-600",children:"You don't have permission to view this page."})]})})}},2278:function(e,s,t){"use strict";t.d(s,{I:function(){return n}});var a=t(7437);t(2265);var r=t(2169);let n=e=>{let{label:s,error:t,helperText:n,className:i,id:l,...c}=e,d=l||"input-".concat(Math.random().toString(36).substr(2,9));return(0,a.jsxs)("div",{className:"space-y-2",children:[s&&(0,a.jsx)("label",{htmlFor:d,className:"block text-sm font-medium text-gray-700",children:s}),(0,a.jsx)("input",{id:d,className:(0,r.cn)("w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",t&&"border-red-500 focus:ring-red-500",i),...c}),t&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:t}),n&&!t&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:n})]})}},492:function(e,s,t){"use strict";t.d(s,{u:function(){return l}});var a=t(7437),r=t(2265),n=t(2169),i=t(2549);let l=e=>{let{isOpen:s,onClose:t,title:l,children:c,size:d="md"}=e;return((0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&t()};return s&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[s,t]),s)?(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:t}),(0,a.jsxs)("div",{className:(0,n.cn)("relative bg-white rounded-lg shadow-xl w-full",{sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[d]),children:[l&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:l}),(0,a.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(i.Z,{className:"h-5 w-5"})})]}),(0,a.jsx)("div",{className:"p-6",children:c})]})]})}):null}},9173:function(e,s,t){"use strict";t.d(s,{P:function(){return n}});var a=t(7437);t(2265);var r=t(2169);let n=e=>{let{label:s,error:t,helperText:n,options:i,className:l,id:c,...d}=e,u=c||"select-".concat(Math.random().toString(36).substr(2,9));return(0,a.jsxs)("div",{className:"space-y-2",children:[s&&(0,a.jsx)("label",{htmlFor:u,className:"block text-sm font-medium text-gray-700",children:s}),(0,a.jsx)("select",{id:u,className:(0,r.cn)("w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",t&&"border-red-500 focus:ring-red-500",l),...d,children:i.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))}),t&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:t}),n&&!t&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:n})]})}},200:function(e,s,t){"use strict";t.d(s,{RM:function(){return l},SC:function(){return c},iA:function(){return n},pj:function(){return u},ss:function(){return d},xD:function(){return i}});var a=t(7437);t(2265);var r=t(2169);let n=e=>{let{children:s,className:t,...n}=e;return(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)("table",{className:(0,r.cn)("w-full border-collapse",t),...n,children:s})})},i=e=>{let{children:s,className:t,...n}=e;return(0,a.jsx)("thead",{className:(0,r.cn)("bg-gray-50",t),...n,children:s})},l=e=>{let{children:s,className:t,...n}=e;return(0,a.jsx)("tbody",{className:(0,r.cn)("bg-white divide-y divide-gray-200",t),...n,children:s})},c=e=>{let{children:s,className:t,...n}=e;return(0,a.jsx)("tr",{className:(0,r.cn)("hover:bg-gray-50 transition-colors",t),...n,children:s})},d=e=>{let{children:s,className:t,...n}=e;return(0,a.jsx)("th",{className:(0,r.cn)("px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",t),...n,children:s})},u=e=>{let{children:s,className:t,...n}=e;return(0,a.jsx)("td",{className:(0,r.cn)("px-4 py-4 whitespace-nowrap text-sm text-gray-900 border-b border-gray-200",t),...n,children:s})}},4706:function(e,s,t){"use strict";t.d(s,{g:function(){return n}});var a=t(7437);t(2265);var r=t(2169);let n=e=>{let{label:s,error:t,helperText:n,className:i,id:l,...c}=e,d=l||"textarea-".concat(Math.random().toString(36).substr(2,9));return(0,a.jsxs)("div",{className:"space-y-2",children:[s&&(0,a.jsx)("label",{htmlFor:d,className:"block text-sm font-medium text-gray-700",children:s}),(0,a.jsx)("textarea",{id:d,className:(0,r.cn)("w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-vertical",t&&"border-red-500 focus:ring-red-500",i),...c}),t&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:t}),n&&!t&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:n})]})}}},function(e){e.O(0,[358,651,396,462,865,971,938,744],function(){return e(e.s=3396)}),_N_E=e.O()}]);